class EventSystem{constructor(){return this.events={},this}getHandlersCount(e){let t=this.events[e];if(!t)return 0;let s=0,n=[];for(n.push(t);n.length>0;){let e=n.pop();for(let t in e)"_handlers"===t?s+=e[t].length:"object"==typeof e[t]&&n.push(e[t])}return s}on(e,t){let s=e.split("."),n=this.events;for(let e=0;e<s.length;e++){let r=s[e];n[r]||(n[r]={}),e===s.length-1?(Array.isArray(n[r]._handlers)||(n[r]._handlers=[]),n[r]._handlers.push(t)):n=n[r]}return this}one(e,t){let s=this,n=e+"."+String.random(8);return this.on(n,function(e){t(e),s.off(n)}),this}off(e,t=!0){let s=e.split("."),n=this.events;for(let e=0;e<s.length;e++){let r=s[e];e===s.length-1?t?delete n[r]:(delete n[r]._handlers,0===Object.keys(n[r]).length&&delete n[r]):n=n[r]}return this}emit(e,t){let s=e.split("."),n=this.events;for(let e=0;e<s.length;e++){if(!(n=n[s[e]]))return this;if(e===s.length-1){let e=[];for(e.push(n);e.length;){let s=e.pop();for(let n in s)if("_handlers"===n)for(let e=0;e<s[n].length;e++)s[n][e](t);else e.push(s[n])}}}return this}}Object.setProperties=function(e,t){for(let s in t)e.hasOwnProperty(s)&&(e[s]=t[s]);return e},Object.isEmpty=function(e){return!Object.keys(e).length},Object.extend=function(){for(let e=1;e<arguments.length;e++)for(let t in arguments[e])arguments[e].hasOwnProperty(t)&&("object"==typeof arguments[0][t]&&"object"==typeof arguments[e][t]?Object.extend(arguments[0][t],arguments[e][t]):arguments[0][t]=arguments[e][t]);return arguments[0]},Object.flatten=function(e){var t={};for(var s in e)if(e.hasOwnProperty(s))if("object"==typeof e[s]&&null!==e[s]){var n=Object.flatten(e[s]);for(var r in n)n.hasOwnProperty(r)&&(t[s+"."+r]=n[r])}else t[s]=e[s];return t},Object.unflatten=function(e){let t={};for(let s in e){let n=s.split(".");n.reduce(function(t,r,a){return t[r]||(t[r]=isNaN(Number(n[a+1]))?n.length-1==a?e[s]:{}:[])},t)}return t},String.random=function(e){for(var t,s="";s.length<e;)s+=(t=Math.floor(62*Math.random()))<10?t:t<36?String.fromCharCode(t+55):String.fromCharCode(t+61);return s},document.getElementsByDataName=function(e){return document.querySelectorAll(`[data-name="${e}"]`)},document.getElementByDataName=function(e){let t=document.getElementsByDataName(e);return t.length?t[0]:null};class IdGenerator{constructor(){return this.counter=0,this.lastTime=0,this}generateId(){let e=microtime.now();return this.lastTime===e?this.counter++:this.counter=0,this.lastTime=e,`${e}${this.counter}`}}class ElementManager extends EventSystem{constructor(e,t,s){return super(),this.options=Object.extend({primaryKey:"id",maxElements:0,cloneTemplate:!0,removeTemplate:!0,removeDeadTemplates:!0},s),this.wrapper=e,this.template=this.options.cloneTemplate?t.cloneNode(!0):t,this.template.removeAttribute("id"),this.template.classList.remove("template"),this.elements=new Map,this.options.removeTemplate&&t.remove(),this.cachedData={},this.processedRenderData={},this}cacheData(e){return Object.extend({},e)}processRenderData(e){return e}empty(){for(;this.wrapper.firstChild;)this.wrapper.removeChild(this.wrapper.firstChild);return this.elements=new Map,this}attachElementHandlers(e){return this}cloneTemplate(){let e=this.template.cloneNode(!0);return this.attachElementHandlers(e),e}appendElement(e){return this.wrapper.appendChild(e),this}appendElementBefore(e,t){return t.before(e),this}appendElementAfter(e,t){return t.after(e),this}removeElement(e){let t=this.elements.get(e);return t&&(this.wrapper.removeChild(t),this.elements.delete(e)),this}removeDeadElements(e){for(let[t,s]of this.elements)this.getData(e,t)||(s.remove(),this.elements.delete(t));return this}getDataType(e){return e instanceof Map?"map":Array.isArray(e)?"array":"object"==typeof e?"object":null}getData(e,t){switch(this.getDataType(e)){case"array":let s=e.filter(function(e){return e.id===t});return s&&s.length?s[0]:null;case"map":return e.get(t);case"object":return e[t];default:return null}}render(e){switch(this.cachedData=this.cacheData(e),this.processedRenderData=this.processRenderData(e),this.getDataType(e)){case"array":this.renderArray(e);break;case"map":this.renderMap(e);break;default:case"object":this.renderObject(e)}return this.options.removeDeadTemplates&&this.removeDeadElements(e),this}renderArray(e){for(let t=0;t<e.length;t++){let s=e[t][this.options.primaryKey];if(void 0===s)return void console.error("ElementManager.renderArray: data must have a primary key property");this.renderElement(s,e[t],t)}return this}renderMap(e){let t=0;for(let[s,n]of e)this.renderElement(s,n,t),t++;return this}renderObject(e){let t=0;for(let s in e)this.renderElement(s,e[s],t),t++;return this}renderSingle(e,t){let s={};return s[e]=t,this.render(s),this}renderElement(e,t,s){let n=!1,r=this.elements.get(e);return r||(n=!0,r=this.cloneTemplate()),r&&(r instanceof Template?r.render(t):Template.render(r,t),n&&(this.elements.set(e,r),this.appendElement(r))),this}static dataArrayToDataObject(e,t="id"){let s={};for(let n=0;n<e.length;n++){let r=e[n][t];void 0===r?console.error(`dataArrayToDataObject: object does not have required "${t}" value`):s[r]=e[n]}return s}}class Template extends HTMLElement{constructor(e={}){return super(),this.options=Object.extend({elements:{},renderAttribute:"data-name",displayBlock:!0},e),this.eventSystem=new EventSystem,this.nativeEvents={},this.elements={},this.cachedData={},this.renderData={},this.isFirstRender=!0,this.observer=new MutationObserver(this.mutationObserverCallback.bind(this)),this.findNamedElements(),this.findElements(this.options.elements),this}mutationObserverCallback(e,t){e.forEach(e=>{switch(e.type){case"childList":case"subtree":return void console.debug("Mutated")}})}connectedCallback(){this.options.displayBlock&&this.classList.add("template-block"),this.attachHandlers()}attachHandlers(){return this}setOptions(e){for(let t in e)this.options.hasOwnProperty(t)&&(this.options[t]=e[t]);return this}static addEventSystem(e){e.eventSystem=new EventSystem,e.nativeEvents={}}static on(e,t,s){let n=t.split(".")[0];e.eventSystem||Template.addEventSystem(e),0===e.eventSystem.getHandlersCount(n)&&(e.nativeEvents[n]=function(t){e.eventSystem.emit(n,t)},e.addEventListener(n,e.nativeEvents[n])),e.eventSystem.on(t,s)}on(e,t){return Template.on(this,e,t),this}static one(e,t,s){let n=t.split(".")[0];e.eventSystem||Template.addEventSystem(e),0===e.eventSystem.getHandlersCount(n)&&(e.nativeEvents[n]=function(t){e.eventSystem.emit(n,t),e.removeEventListener(n,e.nativeEvents[n])},e.addEventListener(n,e.nativeEvents[n])),e.eventSystem.one(t,s)}one(e,t){return Template.one(this,e,t),this}static off(e,t,s=!0){if(!(e.eventSystem instanceof EventSystem))return;let n=t.split(".")[0];e.eventSystem.off(t,s),0===e.eventSystem.getHandlersCount(n)&&e.removeEventListener(n,e.nativeEvents[n])}off(e,t=!0){return Template.off(this,e,t),this}static emit(e,t,s){e.eventSystem instanceof EventSystem&&e.eventSystem.emit(t,s)}emit(e,t){return Template.emit(this,e,t),this}setAttributes(e){for(let t=0;t<e.length;t++){let s=e[t];this.setAttribute(s.name,s.value)}return this}findElements(e){for(let t in e)this.elements[t]=this.querySelector(e[t]);return this.elements}static findNamedElements(e){let t={},s=e.querySelectorAll("[name], [data-name]");for(let e=0;e<s.length;e++){let n=s[e].getAttribute("name");n||(n=s[e].getAttribute("data-name")),n&&(t[n]?(Array.isArray(t[n])||(t[n]=[t[n]]),t[n].push(s[e])):t[n]=s[e])}return t}findNamedElements(){let e=Template.findNamedElements(this);return Object.extend(this.elements,e),this}getElements(){return this.elements}static select(e,t){return"string"==typeof e&&(t=e,e=document.documentElement),e.querySelectorAll(t)}select(e){return Template.select(this,e)}static selectFirst(e,t){let s=Template.select(e,t);return s instanceof NodeList?s[0]:null}selectFirst(e){return Template.selectFirst(this,e)}static selectLast(e,t){let s=Template.select(e,t);return s instanceof NodeList?s[e.length-1]:null}selectLast(e){return Template.selectLast(e)}static append(e,t){t.appendChild(e)}append(e){return Template.append(e,this),this}appendTo(e){return Template.append(this,e),this}static prepend(e,t){t.insertBefore(e,t.firstChild)}prepend(e){return Template.prepend(e,this),this}prependTo(e){return Template.prepend(this,e),this}static empty(e){for(;this.element;)e.removeChild(e.firstChild)}empty(){return Template.empty(this),this}static isVisible(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}isVisible(){return Template.isVisible(this)}static hide(e){"none"!==e.style.display&&(e.previousDisplay=e.style.display),e.style.display="none"}hide(){return Template.hide(this),this}static show(e){e.style.display=e.previousDisplay||"block"}show(){return Template.show(this),this}static display(e,t){return void 0===t&&(t=!Template.isVisible(e)),t?Template.show(e):Template.hide(e)}display(e){return Template.display(this,e),this}static getStyle(e,t){return window.getComputedStyle(e).getPropertyValue(t)}getStyle(e){return Template.getStyle(this,e)}static setHeight(e,t){e.style.height=t+"px"}setHeight(e){return Template.setHeight(this,e),this}static setWidth(e,t){e.style.width=t+"px"}setWidth(e){return Template.setWidth(this,e),this}static addClass(e,t){e.classList.add(t)}addClass(e){return Template.addClass(this,e),this}static hasClass(e,t){return e.classList.contains(t)}hasClass(e){return Template.hasClass(this,e)}static removeClass(e,t){e.classList.remove(t)}removeClass(e){return Template.removeClass(this,e),this}static replaceClass(e,t,s){e.classList.replace(t,s)}replaceClass(e,t){return Template.replaceClass(this,e,t),this}static toggleClass(e,t,s){e.classList.toggle(t,s)}toggleClass(e,t){return Template.toggleClass(this,e,t),this}static getValue(e){return e.value}getValue(){return Template.getValue(this)}static setValue(e,t){e.value=t}setValue(e){return Template.setValue(this,e),this}static enable(e){e.disabled=!1}enable(){return Template.enable(this),this}static disable(e){e.disabled=!0}disable(){return Template.disable(this),this}cacheData(e){return this.cachedData=Object.extend({},e)}processRenderData(e){return this.renderData=e}static render(e,t,s=!1){let n=null;n=s?e.getElements():Template.findNamedElements(e);let r=Object.flatten(t);for(let e in r){let t=r[e],s=n[e];if(s)if(s.render)s.render(t);else{Array.isArray(s)||(s=[s]);for(let e=0;e<s.length;e++){let n=s[e];if("false"!==n.getAttribute("data-render"))if("INPUT"===n.tagName){let e=n.getAttribute("type");e&&("checkbox"===e&&t?n.checked=!0:"radio"===e?n.getAttribute("value")===t&&(n.checked=!0):n.value=t)}else"SELECT"===n.tagName?n.value=t:n.innerHTML=t}}}}render(e){return this.cachedData=this.cacheData(e),this.renderData=this.processRenderData(Object.extend({},e)),this.observer.observe(this,{childList:!0,subtree:!0}),Template.render(this,this.renderData,!0),this.observer.disconnect(),this.isFirstRender=!1,this}}customElements.define("template-element",Template);const Status={none:"none",error:"error",success:"success",processing:"processing",info:"info",warning:"warning",class:{}};Status.class[Status.none]="status-none",Status.class[Status.error]="status-error",Status.class[Status.success]="status-success",Status.class[Status.processing]="status-processing",Status.class[Status.info]="status-info",Status.class[Status.warning]="status-warning",Status.classArray=[Status.class.none,Status.class.error,Status.class.success,Status.class.processing,Status.class.info,Status.class.warning],Status.bgclass={},Status.bgclass[Status.none]="status-bg-none",Status.bgclass[Status.error]="status-bg-error",Status.bgclass[Status.success]="status-bg-success",Status.bgclass[Status.processing]="status-bg-processing",Status.bgclass[Status.info]="status-bg-info",Status.bgclass[Status.warning]="status-bg-warning",Status.bgclassArray=[Status.bgclass.none,Status.bgclass.error,Status.bgclass.success,Status.bgclass.processing,Status.bgclass.info,Status.bgclass.warning],Status.icon={},Status.icon[Status.none]="",Status.icon[Status.error]="",Status.icon[Status.info]="",Status.icon[Status.processing]='<div class="spinner-container"><div class="spinner-wheel"></div></div>',Status.icon[Status.success]="",Status.icon[Status.warning]="";class FeedbackTemplate extends Template{static get observedAttributes(){return["status","text"]}constructor(e={}){return super(Object.extend({elements:{icon:".feedback-icon",text:".feedback-text",close:".feedback-close"}},e)),this}connectedCallback(){super.connectedCallback(),this.attachButtonHandlers()}attachButtonHandlers(){let e=this;return this.elements.close.addEventListener("click",function(){e.remove()}),this}createHtml(){return this.innerHTML="\n            ".trim(),this}attributeChangedCallback(e,t,s){if("status"===e){let e=Status.class.none,t=Status.icon.none;s&&""!==s&&void 0!==Status.bgclass[s]&&(e=Status.bgclass[s],t=Status.icon[s]),this.setClass(e).setIcon(t)}else"text"===e&&this.setText(s)}setStatus(e){return this.setAttribute("status",e),this}clearStatusClass(){return this.classList.remove(...Status.bgclassArray),this}setClass(e){return this.clearStatusClass(),this.classList.add(e),this}setText(e){return this.elements.text.textContent=e,this}setIcon(e){return this.elements.icon.innerHTML=e,this}render(e,t,s){return this.setStatus(e).setText(t).setIcon(s)}renderError(e){return this.render(Status.error,e,Status.icon[Status.error])}renderInfo(e){return this.render(Status.info,e,Status.icon[Status.error])}renderProcessing(e){return this.render(Status.processing,e,Status.icon[Status.processing])}renderSuccess(e){return this.render(Status.success,e,Status.icon[Status.success])}renderWarning(e){return this.render(Status.warning,e,Status.icon[Status.warning])}}customElements.define("template-feedback",FeedbackTemplate);class FormTemplate extends Template{constructor(e={}){let t={getRequest:null,submitRequest:null,validateRequest:null,checkboxMode:FormTemplate.checkboxMode.number,serializeMode:FormTemplate.serializeMode.toObject,excludedFields:["disabled"],useTemplate:!0,elements:{form:"form",footer:".form-footer",reset:'[type="reset"]',submit:'[type="submit"]'}};return super(Object.extend(t,e)),this.serializedData={},this.formattedSerializedData=null,this}connectedCallback(){super.connectedCallback(),this.attachFormHandlers()}attachFormHandlers(){let e=this;return this.elements.form.addEventListener("submit",function(t){t.preventDefault(),e.submit()}),this.elements.form.addEventListener("reset",function(t){t.preventDefault(),e.reload()}),this}displayFooter(e){return Template.display(this.elements.footer,e),this}reload(){return console.log(this.cachedData),Object.isEmpty(this.cachedData)?this.reset():this.render(this.cachedData),this}validate(){}convertCheckbox(e,t){let s=e.checked;switch(t){case FormTemplate.checkboxMode.boolean:return s;case FormTemplate.checkboxMode.string:return s?"1":"0";case FormTemplate.checkboxMode.onOff:return s?"on":"off";default:case FormTemplate.checkboxMode.number:return s?1:0}}isNotExcluded(e){for(let t=0;t<this.options.excludedFields.length;t++)if("disabled"===this.options.excludedFields[t]&&e.hasAttribute("disabled"))return!1;return!0}serialize(){this.serializedData={};let e=Array.from(this.getElementsByTagName("input")),t=Array.from(this.getElementsByTagName("select")),s=Array.from(this.getElementsByTagName("textarea")),n=e.concat(t,s);for(let e=0;e<n.length;e++)this.isNotExcluded(n[e])&&this.serializeInput(n[e]);return this.serializedData}serializeInput(e){let t=e.getAttribute("name"),s=null;switch(e.getAttribute("type")){case"checkbox":s=this.convertCheckbox(e,this.options.checkboxMode);break;case"radio":if(!e.checked)return null;s=e.value;break;case"file":e.files.length>0&&(s=e.files[0]);break;case"number":s=Number(e.value);break;default:s=e.value}return this.serializedData[t]=s}serializeTextarea(e){return this.serializeSelect(e)}serializeSelect(e){let t=e.getAttribute("name");return this.serializedData[t]=e.value}formatSerializedData(e,t){switch(t){case FormTemplate.serializeMode.toString:return this.serializedDataToString(e);default:case FormTemplate.serializeMode.toObject:return this.serializedData=Object.unflatten(this.serializedData),this.serializedData}}serializedDataToString(e){let t="",s=0,n=Object.keys(e).length;for(let r in e)t+=r+"="+e[r],s++<n-1&&(t+="&");return t}submit(){let e=this;return this.serializedData=this.serialize(),this.formattedSerializedData=this.formatSerializedData(this.serializedData,this.options.serializeMode),this.options.submitRequest(this.formattedSerializedData).then(function(t){e.emit("success",t)}).catch(function(t){e.emit("fail",t)})}}FormTemplate.checkboxMode={boolean:0,number:1,string:2,onOff:3},FormTemplate.serializeMode={toString:0,toOrderedString:1,toObject:2,toValue:3},customElements.define("template-form",FormTemplate);class PagerTemplate extends Template{constructor(e){return super(e),this.page=1,this.pageCount=1,this}connectedCallback(){super.connectedCallback(),this.attachButtonHandlers()}setPageCount(e){return this.pageCount=e,this.render(),this}setPage(e){return this.page=e,this.render(),this}render(e={}){return void 0===e.pageCount&&(e.pageCount=this.pageCount),void 0===e.page&&(e.page=this.page),super.render(e),e.pageCount<=1?(this.disableNextButton(),this.disablePreviousButton()):e.page===e.pageCount?(this.disableNextButton(),this.enablePreviousButton()):1===e.page?(this.disablePreviousButton(),this.enableNextButton()):(this.enableNextButton(),this.enablePreviousButton()),this}displayNextButton(e){return Template.display(this.elements.next,e),this}displayPreviousButton(){return Template.display(this.elements.previous,state),this}enableNextButton(){return Template.enable(this.elements.next),this}disableNextButton(){return Template.disable(this.elements.next),this}enablePreviousButton(){return Template.enable(this.elements.previous),this}disablePreviousButton(){return Template.disable(this.elements.previous),this}attachButtonHandlers(){let e=this;Template.on(this.elements.next,"click.pager",function(){e.setPage(e.page+1),e.emit("next")}),Template.on(this.elements.previous,"click.pager",function(){e.setPage(e.page-1),e.emit("previous")});let t=null;return Template.on(this.elements.page,"input.pager",function(){clearTimeout(t),t=setTimeout(function(){let t=parseInt(e.elements.page.value);t&&t<=e.pageCount&&(e.page=t,e.emit("page",e.page))},150)}),this}}customElements.define("template-pager",PagerTemplate);class PopupTemplate extends Template{constructor(e={}){return super(Object.extend({displayBlock:!1,showHeader:!0,showClose:!0,showFooter:!0,elements:{header:".popup-header",title:".popup-title",close:".popup-close",body:".popup-body",footer:".popup-footer"}},e)),this}connectedCallback(){super.connectedCallback(),this.applyOptions(this.options),this.attachButtonHandlers()}attachButtonHandlers(){let e=this;return this.elements.close.addEventListener("click",function(t){e.close()}),this}applyOptions(e){return!e.showHeader&&this.elements.header&&this.elements.header.remove(),!e.showClose&&this.elements.close&&this.elements.close.remove(),!e.showFooter&&this.elements.footer&&this.elements.footer.remove(),this}open(){return document.body.classList.add("popup-open"),this.show(),this}close(){return document.body.classList.remove("popup-open"),this.hide(),this}renderTitle(e){return this.elements.title.innerHTML=e,this}renderBody(e){return this.elements.body.innerHTML=e,this}renderFooter(e){return this.elements.footer.innerHTML=e,this}}customElements.define("template-popup",PopupTemplate);class StatusTemplate extends Template{static get observedAttributes(){return["status","text"]}constructor(e){return super(e),this}connectedCallback(){return super.connectedCallback(),this.hasAttribute("status")||this.setAttribute("status",Status.none),this.hasAttribute("text")||this.setAttribute("text",""),this}attributeChangedCallback(e,t,s){if("status"===e){let e=Status.class.none;s&&""!==s&&void 0!==Status.class[s]&&(e=Status.class[s]),this.setClass(e)}else"text"===e&&this.setText(s)}setStatus(e){return this.setAttribute("status",e),this}clearStatusClass(){return this.classList.remove(...Status.classArray),this}setClass(e){return this.clearStatusClass(),this.classList.add(e),this}setText(e){return this.textContent=e,this}render(e,t){return this.setStatus(e).setText(t)}renderNone(e){return this.render(Status.none,e)}renderError(e){return this.render(Status.error,e)}renderSuccess(e){return this.render(Status.success,e)}renderInfo(e){return this.render(Status.info,e)}renderWarning(e){return this.render(Status.warning,e)}}customElements.define("template-status",StatusTemplate);class TableTemplate extends Template{constructor(e={}){return super(Object.extend({alwaysRebuild:!1,columns:[],columnTitles:[],elements:{table:"table",thead:"thead",theadTr:"thead > tr",tbody:"tbody",tfoot:"tfoot",tr:"tbody > tr"}},e)),this.schema={},this.rowManager=null,this}connectedCallback(){super.connectedCallback(),this.elements&&this.elements.tr instanceof HTMLElement&&(this.columnCount=this.elements.tr.querySelectorAll("td").length,this.elements.tr.remove()),this.createRowManager()}createRowManager(){let e=this.elements&&this.elements.tbody instanceof HTMLElement?this.elements.tbody:document.createElement("div");return this.rowManager=new ElementManager(e,this.elements.tr)}createHtml(){return this.innerHTML="<table><tbody></tbody></table>",this}render(e){return this.cacheData(e),this.processRenderData(e),this.options.alwaysRebuild?this.empty():Array.isArray(this.renderData)&&void 0===this.renderData[0][this.options.primaryKey]&&this.empty(),this.rowManager.render(this.renderData),this}empty(){return this.rowManager.empty(),this}createHeader(){return document.createElement("thead")}createHeaderColumn(){return document.createElement("th")}addHeader(e){return Template.prepend(e,this.elements.table),this}generateHeader(e,t){this.elements.thead=this.createHeader();let s=this.createRow();for(let n=0;n<e.length;n++){let r=this.createHeaderColumn();r.innerHTML=t?t[n]:e[n],s.appendChild(r)}return this.elements.thead.appendChild(s),this.addHeader(this.elements.thead),this}createRow(){return document.createElement("tr")}cloneRow(){return this.elements.tr.cloneNode(!0)}appendRow(e){return this.elements.tbody.appendChild(e),this}removeRow(e){}generateRow(){this.elements.tr=this.createRow();for(let e=0;e<this.options.columns.length;e++){let t=this.createColumn();t.setAttribute("data-name",this.options.columns[e]),this.elements.tr.appendChild(t)}return this.elements.tbody.appendChild(this.elements.tr),this}createColumn(){return document.createElement("td")}appendColumnToRow(e,t){return e.appendChild(t),this}resetDom(){if(this.elements)for(let e in this.elements){let t=this.elements[e];t instanceof HTMLElement&&t.remove()}return this.elements={},this}setSchema(e){return this.options.columns=e.columns,e.columnTitles&&(this.options.columnTitles=e.columnTitles),e.primaryKey&&(this.options.primaryKey=e.primaryKey),this.resetDom(),this.createHtml(),this.findNamedElements(),this.findElements(this.options.elements),this.generateHeader(this.options.columns,this.options.columnTitles),this.generateRow(),this}}customElements.define("template-table",TableTemplate);class WizardTemplate extends FormTemplate{constructor(e){return super(Object.extend({elements:{navs:".wizard-navs",tabs:".wizard-tabs",pager:"template-pager"}},e)),this.tabCount=0,this.tab=0,this}connectedCallback(){super.connectedCallback(),this.tabCount=this.elements.tabs.children.length,this.elements.pager.setPage(1),this.elements.pager.setPageCount(this.tabCount),this.attachNavHandlers(),this.attachPagerHanders(),this.goToFirstTab()}isValidTabIndex(e){return e>-1&&e<this.tabCount}displayTab(e,t){if(this.isValidTabIndex(e)){let s=this.elements.tabs.children[e];Template.display(s,t)}return this}hideTabs(){for(let e=0;e<this.tabCount;e++)this.displayTab(e,!1);return this}goToTab(e){return this.isValidTabIndex(e)&&(this.hideTabs(),this.displayTab(e,!0),this.tab=e,this.elements.pager.setPage(e+1)),this}goToFirstTab(){return this.goToTab(0),this}goToLastTab(){return this.goToTab(this.tabCount-1),this}goToNextTab(){return this.tab<this.tabCount-1&&(this.tab++,this.goToTab(this.tab)),this}goToPreviousTab(){return this.tab>0&&(this.tab--,this.goToTab(this.tab)),this}attachPagerHanders(){let e=this;this.elements.pager.on("next",function(){e.goToNextTab()}),this.elements.pager.on("previous",function(){e.goToPreviousTab()}),this.elements.pager.on("page",function(t){e.goToTab(t-1)})}attachNavHandlers(){let e=this;for(let t=0;t<this.tabCount;t++){let s=this.elements.navs.children[t];Template.on(s,"click.wizard",function(){e.goToTab(t)})}return this}renderPager(){return this.elements.pager.setPage(this.tab+1),this.elements.pager.setPageCount(this.tabCount),this}validateTab(e){return this.isValidTabIndex(e),this}}customElements.define("template-wizard",WizardTemplate);class WebSocketClient extends EventSystem{constructor(e){super();let t={ip:"wss://localhost",port:443,autoReconnect:!0,maxReconnectAttempts:0,reconnectIntervalTimer:5e3,id:null};for(let s in t)e.hasOwnProperty(s)&&void 0!==e[s]&&(t[s]=e[s]);return this.ip=t.ip,this.port=t.port,this.id=t.id,this.ws=null,this.lastPingSent=0,this.latency=0,this.reconnectInterval=null,this.reconnectAttempts=0,this.reconnectIntervalTimer=t.reconnectIntervalTimer,this.maxReconnectAttempts=t.maxReconnectAttempts,this.autoReconnect=t.autoReconnect,this}setId(e){return this.id=e,this}connect(){let e=this.ip+":"+this.port;return null!==this.id&&(e+="/?id="+this.id),this.close(),this.ws=new WebSocket(e),this.attachWebSocketHandlers(),this}close(){return this.ws&&this.ws.close(),this.ws=null,this}attachWebSocketHandlers(){let e=this;return this.ws.addEventListener("open",function(t){console.log(t),e.stopAutoReconnect(),e.emit("open",t)}),this.ws.addEventListener("message",function(t){if(console.log(t),"ping"===t.data)e.send("pong");else if("pong"===t.data)e.recordLatency();else{let s={};try{s=JSON.parse(t.data),e.emit("message",s)}catch(e){console.error(e)}}}),this.ws.addEventListener("error",function(t){console.log(t),e.emit("error",t),e.autoReconnect&&null===e.reconnectInterval&&e.startAutoReconnect()}),this.ws.addEventListener("close",function(t){console.log(t),e.emit("close",t),!t.wasClean&&e.autoReconnect&&null===e.reconnectInterval&&e.startAutoReconnect()}),this}send(e){return this.ws.send(e),this}sendJson(e){return this.send(JSON.stringify(e))}startAutoReconnect(){let e=this;return this.reconnectAttempts=0,this.reconnectInterval=setInterval(function(){e.reconnect()},this.reconnectIntervalTimer),this}stopAutoReconnect(){return clearInterval(this.reconnectInterval),this.reconnectInterval=null,this}reconnect(){return!this.maxReconnectAttempts||this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,this.connect()):this.stopAutoReconnect(),this}ping(){return this.lastPingSent=performance.now(),this.send({route:"/ping"})}pong(){return this.send({route:"/pong"})}recordLatency(){return this.latency=performance.now()-this.lastPingSent,this}}class ChatRoomMessageTemplate extends Template{constructor(){return super({elements:{avatar:'[data-name="avatar"]',user:'[data-name="user"]',text:'[data-name="text"]'}}),this}processRenderData(e){return e.user=e.user+":",e}}customElements.define("template-chatroom-message",ChatRoomMessageTemplate);class ChatRoomMessageTemplateManager extends ElementManager{constructor(e){return super(e,document.getElementById("chatroom-message-template"),{removeTemplate:!1,removeDeadTemplates:!1}),this}appendMessage(e,t){return this.renderSingle(e,t)}}class ChatRoomUserTemplate extends Template{constructor(){return super({elements:{avatar:'[data-name="avatar"]',name:'[data-name="name"]'}}),this}processRenderData(e){return e.avatar&&""!==e.avatar||(e.avatar="<img src='/img/avatar.png'>"),e}}customElements.define("template-chatroom-user",ChatRoomUserTemplate);class ChatRoomUserTemplateManager extends ElementManager{constructor(e){return super(e,document.getElementById("chatroom-user-template"),{removeTemplate:!1,removeDeadTemplates:!1}),this}appendClient(e,t){return this.renderSingle(e,t),this}removeClient(e){return this.removeElement(e),this}}class ChatRoomTemplate extends Template{constructor(e={}){return super(Object.extend({elements:{header:".chatroom-header",icon:".chatroom-icon",img:".chatroom-img",lock:".chatroom-ock",info:".chatroom-info",users:".chatroom-users",clientCount:'[data-name="clientCount"]',name:'[data-name="name"]',room:".chatroom-room",chat:".chatroom-chat",userList:".chatroom-userlist",textInput:'[name="text"]',submitButton:'[type="submit"]'}},e)),this.userManager=new ChatRoomUserTemplateManager(this.elements.userList),this.messageManager=new ChatRoomMessageTemplateManager(this.elements.chat),this}connectedCallback(){super.connectedCallback(),this.attachInputHandlers(),this.attachDomHandlers(),this.attachButtonHandlers()}attachInputHandlers(){let e=this;function t(t){13===t.keyCode&&e.submit()}return this.elements.textInput.addEventListener("focus",function(){document.addEventListener("keyup",t)}),this.elements.textInput.addEventListener("blur",function(){document.removeEventListener("keyup",t)}),this}attachDomHandlers(){return this.elements.header.addEventListener("click",function(){Template.toggle(self.elements.room)}),this}attachButtonHandlers(){let e=this;return this.elements.submitButton.addEventListener("click",function(){e.submit()}),this}serializeMessage(){return{text:this.elements.textInput.value}}clearInput(){return this.elements.textInput.value="",this}scrollChatToBottom(){return this.elements.chat.scrollTop=this.elements.chat.scrollHeight-this.elements.chat.clientHeight,this}submit(){let e=this.serializeMessage();return this.emit("message",e),this.clearInput(),this}processRenderData(e){return e.maxClients=e.maxClients?"/"+e.maxClients:"",e}renderClientCount(e){return this.elements.clientCount.innerHTML=e,this}appendMessage(e){return this.messageManager.appendMessage(e.id,e),this.scrollChatToBottom(),this}appendClient(e){return this.userManager.appendClient(e.id,e),this.cachedData.clientCount++,this.renderClientCount(this.cachedData.clientCount),this}removeClient(e){return this.userManager.removeClient(e),this.cachedData.clientCount--,this.renderClientCount(this.cachedData.clientCount),this}render(e){super.render(e);let t=ElementManager.dataArrayToDataObject(e.clients);return this.userManager.render(t),this.messageManager.render(e.messages),this}}customElements.define("template-chatroom",ChatRoomTemplate);class ChatRoomTemplateManager extends ElementManager{constructor(){return super(document.getElementById("chatroom-list"),document.getElementById("chatroom-template"),{removeTemplate:!1}),this}attachElementHandlers(e){e.on("message",function(e){console.log(e)})}}class Chat extends EventSystem{constructor(){return super(),this.wrapper=document.getElementById("chat"),this.webSocketClient=new WebSocketClient({ip:"ws://localhost",port:5001}),this.attachWebSocketClientHandlers(),this.chatRoomManager=new ChatRoomTemplateManager,this}attachWebSocketClientHandlers(){let e=this;return this.webSocketClient.on("open",function(){e.getChatRooms()}),this.webSocketClient.on("message",function(t){e.routeMessage(t)}),this}routeMessage(e){return 0===e.status?(console.error("bad message"),console.error(e),this):this}sendMessage(e){return this.webSocketClient.sendJson(e),this}getChatRooms(){let e=this;return fetch("/rooms").then(function(e){return e.json()}).then(function(t){e.renderChatRooms(t)}).catch(function(e){console.error(e)}),this}renderChatRooms(e){return this.chatRoomManager.render(e),this}toggle(e){return Template.toggle(this.wrapper,e),this}initialize(){return this.webSocketClient.connect(),this}}class App{constructor(){return this.wrapper=document.getElementById("app"),this.loader=document.getElementById("loader"),this.chat=new Chat,this.chat.initialize(),this}initialize(){return this}}let app=new App;app.initialize();